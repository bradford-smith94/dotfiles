# Bradford Smith
# ~/.shell_env
# updated: 12/02/2017
#####################

# turn off flow control (ctrl-q and ctrl-s)
stty -ixon
stty -ixoff

# source aliases
if [ -f "$HOME/.shell_aliases" ]; then
    # shellcheck source=/dev/null
    . "$HOME/.shell_aliases"
fi

# source local shell config
if [ -f "$HOME/.shell_env.local" ]; then
    # shellcheck source=/dev/null
    . "$HOME/.shell_env.local"
fi

# make less more friendly for non-text input files, see lesspipe(1)
if command -v lesspipe.sh >/dev/null 2>&1; then
    eval "$(lesspipe.sh)"
fi

# use dircolors to set $LC_COLORS
if [ -f /usr/bin/dircolors ]; then
    [ -e "$HOME/.dir_colors" ] && DIR_COLORS="$HOME/.dir_colors"
    [ -e "$DIR_COLORS" ] || DIR_COLORS=""
    eval "$(dircolors -b $DIR_COLORS)"
fi

# if ~/.npm_pkgs exists add it to the beginning of the path
if [ -d "$HOME/.npm_pkgs" ]; then
    PATH=$PATH:$HOME/.npm_pkgs/bin/
    export MANPATH=$MANDATORY_MANPATH:$HOME/.npm_pkgs/share/man/
fi

# if ~/bin exists add it to the beginning of the path
if [ -d "$HOME/bin" ]; then
    PATH=$HOME/bin:$PATH
fi

# if android tools exist add them to the path
if [ -d /opt/android-sdk/tools/ ]; then
    PATH=$PATH:/opt/android-sdk/tools/
fi
export PATH=$PATH

# use vim as the default editor and man pager
if command -v vim >/dev/null 2>&1; then
    export EDITOR="vim"
    export MANPAGER="vim -"
fi

# enable xterm transparency with transset-df
if command -v transset-df >/dev/null 2>&1; then
    [ -n "$XTERM_VERSION" ] && transset-df --id "$WINDOWID" .95 >/dev/null
fi

# start ssh-agent
# https://wiki.archlinux.org/index.php?title=SSH_keys&redirect=no#SSH_agents
if ! pgrep -u "$USER" ssh-agent > /dev/null; then
    ssh-agent > ~/.ssh-agent-output
fi
if [[ "$SSH_AGENT_PID" == "" ]]; then
    eval "$(<~/.ssh-agent-output)" > /dev/null
fi

case $(tty) in
    # if in a tty (vt)
    /dev/tty[0-9]*)
        ;;
    # else in a ptty
    *)
        # if not in SSH
        if [ "x${SSH_TTY}" = "x" ]; then
            #   and screenfetch is installed
            if [ -f /usr/bin/screenfetch ]; then
                screenfetch
            fi
        fi
        ;;
esac
